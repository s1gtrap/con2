const apiUrl = process.env['REACT_APP_API_URL'] || '';

export type Stop = {
  id: string,
  name: string,
  x: number,
  y: number,
};

type Opts = { method?: string, headers?: { [index: string]: string; }, body?: any };

async function dummyFetch<T>(resource: string, opts: Opts = {}): Promise<T> {
  console.log(resource, opts);
  if (resource === '/api/v1/me') {
    return {
      id: '00000000-0000-0000-0000-000000000000',
    } as T;
  } else if (resource === '/api/v1/reports') {
    const coords = await geolocation();
    const stops = await fetchNearbyStops(coords.latitude, coords.longitude);
    return stops.slice(0, 5).map((s) => ({
      id: '00000000-0000-0000-0000-000000000000',
      stop: s.id,
      image: 'data:image/jpeg;base64,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',
      name: s.name,
      lat: s.y / 1000000,
      lng: s.x / 1000000,
    })) as T;
  } else if (resource === '/api/v1/invite' && opts.method?.toLowerCase() === 'post') {
    return {
      token: "con2=hey if youre reading this im sorry but this invite is coming from a demo user :-(",
      inviterId: '00000000-0000-0000-0000-000000000000',
    } as T;
  } else if (resource.startsWith('/api/v1/invite') && opts.method?.toLowerCase() === 'get') {
    console.log(opts);
  }

  return null as T;
}

export async function fetchJson<T>(resource: string, opts: Opts = {}): Promise<T> {
  const opts2 = {
    ...opts,
    headers: {
      ...(opts.headers ? opts.headers : {}),
      ...(opts.body ? { 'content-type': 'application/json' } : {}),
    },
    ...(opts.body ? { body: JSON.stringify(opts.body) } : {}),
  }
  if (opts.headers && opts.headers.authorization as unknown as string === 'Bearer dummy-demo') {
    return dummyFetch(resource, opts2);
  } else {
    const res = await fetch(`${apiUrl}${resource}`, opts2);
    const data = await res.json();
    if (!res.ok) {
      throw new Error(data.message);
    }
    return data;
  }
}

export async function fetchAuthJson<T>(accessToken: string, resource: string, opts: Opts = {}): Promise<T> {
  return await fetchJson<T>(resource, {
    ...opts,
    headers: {
      ...(opts.headers || {}),
      'authorization': `Bearer ${accessToken}`,
    },
  });
}

export async function fetchNearbyStops(lat: number, lng: number): Promise<Stop[]> {
  const x = Math.round(lat * 1000000);
  const y = Math.round(lng * 1000000);
  const res = await fetch(`https://xmlopen.rejseplanen.dk/bin/rest.exe/stopsNearby?coordX=${x}&coordY=${y}`);
  const xml = await res.text();
  const parser = new DOMParser();
  const list = parser.parseFromString(xml, "text/xml");
  return Array.from(list.getElementsByTagName('StopLocation'))
    .map((stop) => {
      return {
        id: stop.getAttribute('id')!,
        name: stop.getAttribute('name')!,
        x: Number(stop.getAttribute('x')!),
        y: Number(stop.getAttribute('y')!),
      };
    });
}

export function geolocation(): Promise<GeolocationCoordinates> {
  return new Promise((resolve, reject) => {
    navigator.geolocation.getCurrentPosition(
      (position: GeolocationPosition) => resolve(position.coords),
      reject,
    );
  });
}
